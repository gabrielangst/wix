<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Sintonia - Edi√ß√£o Precisa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --panel-color: #16213e;
            --accent-color: #e94560;
            --secondary-zone: #ff9f1c; /* Laranja */
            --text-color: #fff;
            --blue-btn: #00bcd4;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
            overflow-x: hidden;
            padding-bottom: 50px;
        }

        h1 { margin: 20px 0 10px; font-size: 2rem; letter-spacing: 2px; text-transform: uppercase; color: var(--accent-color); }

        /* --- OVERLAY SPOTLIGHT --- */
        #dim-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); z-index: 90; opacity: 0; pointer-events: none; transition: opacity 0.5s ease;
        }

        .spotlight-active {
            position: relative; z-index: 100 !important; filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.2));
        }

        /* --- PONTUA√á√ÉO FLUTUANTE --- */
        #feedback-score {
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 8rem;
            font-weight: 900;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            text-shadow: 0 0 20px rgba(0,0,0,0.8);
        }

        .anim-pop { animation: popIn 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -60%) scale(1); opacity: 0; }
        }

        /* --- MOSTRADOR --- */
        .gauge-wrapper {
            position: relative;
            width: 640px;
            height: 320px;
            margin: 30px auto 0;
            overflow: visible; 
            cursor: crosshair;
        }

        .gauge-bg {
            position: absolute; bottom: 0; left: 20px; width: 600px; height: 300px;
            background: linear-gradient(90deg, #ff4d4d 0%, #ffff00 50%, #4dff4d 100%);
            border-top-left-radius: 300px; border-top-right-radius: 300px; opacity: 0.2; z-index: 1; pointer-events: none;
        }

        .tick-mark {
            position: absolute; bottom: 0; left: 50%; width: 2px; height: 310px; background: transparent; transform-origin: bottom center; z-index: 2; pointer-events: none; border-top: 10px solid rgba(255,255,255,0.4);
        }
        
        .tick-number {
            position: absolute; top: -30px; left: -20px; width: 40px; text-align: center; font-size: 1rem; font-weight: bold; color: rgba(255,255,255,0.9); text-shadow: 0 2px 4px #000;
        }

        .target-zone {
            position: absolute; bottom: 0; left: 50%; width: 600px; height: 300px; transform-origin: bottom center; opacity: 0; pointer-events: none; z-index: 3; margin-left: 0;
        }
        
        /* C√°lculo Visual Exato:
           Raio (Altura) ~ 320px.
           100 pontos = 180 graus.
        */

        /* Zona Externa (+2 pontos): +/- 10 unidades (Total 20) -> 36 graus
           Largura do cone no topo = 2 * 320 * tan(18deg) ~= 208px 
        */
        .wedge-outer {
            position: absolute; 
            bottom: 0; 
            left: 50%; 
            width: 208px; /* Ajustado para +/- 10 */
            height: 320px; 
            background-color: var(--secondary-zone); 
            transform: translateX(-50%); 
            clip-path: polygon(0 0, 100% 0, 50% 100%); /* Tri√¢ngulo completo */
            opacity: 0.8; 
            z-index: 3;
        }

        /* Zona Interna (+4 pontos): +/- 5 unidades (Total 10) -> 18 graus
           Largura do cone no topo = 2 * 320 * tan(9deg) ~= 101px
        */
        .wedge-inner {
            position: absolute; 
            bottom: 0; 
            left: 50%; 
            width: 101px; /* Ajustado para +/- 5 */
            height: 320px; 
            background-color: #fff; 
            transform: translateX(-50%); 
            clip-path: polygon(0 0, 100% 0, 50% 100%);
            z-index: 4; 
            box-shadow: 0 0 10px white;
        }

        .needle {
            position: absolute; bottom: 0; left: 50%; width: 6px; height: 280px; background-color: #fff; border: 2px solid #000; transform-origin: bottom center; transform: translateX(-50%) rotate(-90deg); transition: transform 0.1s linear; z-index: 10; border-radius: 3px; pointer-events: none;
        }

        .needle-knob {
            position: absolute; bottom: -25px; left: 50%; width: 50px; height: 50px; background-color: #fff; border: 4px solid var(--accent-color); border-radius: 50%; transform: translateX(-50%); z-index: 11; pointer-events: none;
        }

        /* --- CONTROLES --- */
        .controls-area {
            background: var(--panel-color); padding: 15px 30px; border-radius: 15px; width: 90%; max-width: 800px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.3); margin-top: 5px; position: relative;
        }

        .range-slider { width: 100%; margin: 10px 0; cursor: pointer; accent-color: var(--accent-color); }

        .btn-group { display: flex; justify-content: center; gap: 15px; margin-top: 15px; min-height: 50px; }

        button {
            border: none; color: white; padding: 10px 20px; border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: opacity 0.2s, transform 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        button:active { transform: translateY(0); }

        .btn-reveal { background-color: #e94560; }
        .btn-new { background-color: #4ecca3; color: #1a1a2e; display: none; }
        .btn-theme { background-color: #3f51b5; font-size: 0.9rem; padding: 8px 15px; }
        .btn-score { padding: 5px 12px; font-size: 0.85rem; margin: 0 2px;}
        button:disabled { background-color: #555; cursor: not-allowed; color: #888; transform: none; box-shadow: none; }

        /* --- INFO --- */
        #info-section { display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 20px; text-align: left; }
        #qr-wrapper { text-align: center; min-width: 140px; }
        #qr-container { background: white; padding: 10px; border-radius: 10px; display: inline-block; min-height: 120px; }
        #theme-display { background: rgba(255,255,255,0.05); padding: 15px 20px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); min-width: 300px; max-width: 450px; position: relative; }
        .theme-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #444; padding-bottom: 8px; margin-bottom: 10px; }
        .theme-extreme { font-size: 1.1rem; color: #ddd; margin: 8px 0; display: flex; align-items: flex-start; }
        .theme-extreme span.label { font-weight: bold; color: var(--accent-color); min-width: 40px; margin-right: 5px; }

        /* --- PLACAR --- */
        .scoreboard { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 15px; margin-top: 20px; width: 100%; }
        .team-card { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; min-width: 140px; text-align: center; border: 1px solid rgba(255,255,255,0.1); position: relative; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .team-name { font-size: 1rem; color: #ccc; margin-bottom: 5px; border-bottom: 1px dashed rgba(255,255,255,0.3); cursor: text; }
        .team-score { font-size: 2rem; font-weight: bold; color: var(--accent-color); margin: 5px 0; cursor: text; min-height: 40px; }
        .score-controls { display: flex; justify-content: center; margin-top: 5px; gap: 2px;}
        .btn-add-team { background: transparent; border: 2px dashed #444; color: #666; width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 2rem; cursor: pointer; transition: all 0.2s; padding: 0; box-shadow: none; }
        .btn-add-team:hover { border-color: var(--accent-color); color: var(--accent-color); transform: scale(1.1); }
        .btn-remove-team { position: absolute; top: -5px; right: -5px; background: #e94560; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 0.7rem; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.2s; }
        .team-card:hover .btn-remove-team { opacity: 1; }
    </style>
</head>
<body>

    <div id="dim-overlay"></div>
    <div id="feedback-score"></div>

    <h1>Sintonia</h1>

    <div class="gauge-wrapper" id="gauge-main" onclick="moveNeedleByClick(event)">
        <div class="gauge-bg"></div>
        <div id="ticks-container"></div> 
        <div id="target-zone" class="target-zone">
            <div class="wedge-outer"></div>
            <div class="wedge-inner"></div>
        </div>
        <div id="needle" class="needle"></div>
        <div class="needle-knob"></div>
    </div>

    <div class="controls-area">
        <div style="font-size: 1.1rem; margin-bottom: 5px;">
            Posi√ß√£o: <span id="display-val" style="color:var(--accent-color); font-weight:bold;">0</span>
        </div>
        
        <input type="range" id="dial-slider" class="range-slider" min="0" max="100" value="0" step="5" oninput="updateNeedle(this.value)">

        <div class="btn-group">
            <button onclick="revealAnimation()" id="btn-reveal" class="btn-reveal">üëÅÔ∏è Revelar</button>
            <button onclick="startNewRound()" id="btn-new" class="btn-new">üé≤ Nova Rodada</button>
        </div>

        <div id="info-section">
            <div id="qr-wrapper">
                <div id="qr-container"></div>
                <div style="font-size:0.8rem; color:#aaa; margin-top:5px;">Aponte a c√¢mera</div>
            </div>

            <div id="theme-display">
                <div class="theme-header">
                    <h3 style="margin:0; font-size:1rem; color:#888; text-transform:uppercase;">Tema da Rodada</h3>
                    <button class="btn-theme" onclick="shuffleTheme()" title="Trocar Tema">üîÑ Trocar</button>
                </div>
                <div class="theme-extreme"><span class="label">0:</span> <span id="theme-0">...</span></div>
                <div class="theme-extreme"><span class="label">100:</span> <span id="theme-100">...</span></div>
            </div>
        </div>
    </div>

    <div class="scoreboard" id="scoreboard"></div>

    <br>

    <div class="version" id="version">V 1.0 | 13/02/2026</div>
    <div class="version" id="version">Vers√£o de Gabriel Angst</div>

    <script>
        let currentTarget = 0;
        let teamCount = 0;

        const themes = [
            { min: "Cidade ruim", max: "Cidade incr√≠vel" },
            { min: "Comida ruim", max: "Comida gostosa" },
            { min: "Caracter√≠stica ruim de uma pessoa", max: "Caracter√≠stica boa de uma pessoa" },
            { min: "Filme chato", max: "Filme legal" },
            { min: "Emprego ruim", max: "Emprego dos sonhos" },
            { min: "Superpoder in√∫til", max: "Superpoder incr√≠vel" },
            { min: "Animal inofensivo", max: "Animal letal" },
            { min: "Objeto barato", max: "Objeto de luxo" },
            { min: "M√∫sica triste", max: "M√∫sica feliz" },
            { min: "Pessoa desonesta", max: "Pessoa √≠ntegra" },
            { min: "Cheiro ruim", max: "Cheiro maravilhoso" },
            { min: "H√°bito irritante", max: "H√°bito atraente" },
            { min: "Personagem fraco", max: "Personagem poderoso" },
            { min: "Ator/Atriz ruim", max: "Ator/Atriz genial" },
            { min: "Presente terr√≠vel", max: "Presente perfeito" },
            { min: "Jeito ruim de morrer", max: "Jeito her√≥ico de morrer" },
            { min: "Animal fofo", max: "Animal assustador" },
            { min: "Coisa de rico", max: "Coisa de pobre" },
            { min: "Comida saud√°vel", max: "Comida porcaria (Junk food)" },
            { min: "Lugar barulhento", max: "Lugar silencioso" },
            { min: "Pessoa feia", max: "Pessoa bonita" },
            { min: "M√∫sica antiga", max: "M√∫sica atual" },
            { min: "Lugar frio", max: "Lugar quente" },
            { min: "Motivo bobo para terminar", max: "Motivo s√©rio para terminar" },
            { min: "Caf√© da manh√£", max: "Jantar" },
            { min: "Roupa desconfort√°vel", max: "Roupa confort√°vel" },
            { min: "Som irritante", max: "Som relaxante" },
            { min: "Tarefa f√°cil", max: "Tarefa imposs√≠vel" },
            { min: "Inven√ß√£o in√∫til", max: "Inven√ß√£o revolucion√°ria" },
            { min: "Marca ruim", max: "Marca de prest√≠gio" },
            { min: "Doce enjoativo", max: "Doce perfeito" },
            { min: "Banda ruim", max: "Banda lend√°ria" },
            { min: "Mentira inocente", max: "Mentira grave" },
            { min: "Sobremesa leve", max: "Sobremesa pesada" },
            { min: "Carro popular", max: "Carro de luxo" },
            { min: "Filme para crian√ßas", max: "Filme para adultos" },
            { min: "Salgado de festa ruim", max: "O melhor salgado de festa" },
            { min: "Fruta boa", max: "Fruta ruim" },
            { min: "Jogo f√°cil", max: "Jogo dif√≠cil" },
            { min: "Lugar sujo", max: "Lugar limpo" },
            { min: "Trabalho bra√ßal", max: "Trabalho intelectual" },
            { min: "M√∫sica para chorar", max: "M√∫sica para dan√ßar" },
            { min: "Animal de estima√ß√£o ex√≥tico", max: "Animal de estima√ß√£o comum" },
            { min: "Cidade com clima quente", max: "Cidade com clima frio" },
            { min: "Sabor amargo", max: "Sabor doce" },
            { min: "Roupa formal", max: "Roupa casual" },
            { min: "Coisa fr√°gil", max: "Coisa indestrut√≠vel" },
            { min: "Pior jeito de gastar dinheiro", max: "Melhor investimento" },
            { min: "Medo irracional", max: "Medo justificado" },
            { min: "Etiqueta social (Educado)", max: "Falta de educa√ß√£o" },
            { min: "Tempor√°rio", max: "Eterno" },
            { min: "Parece gostoso mas √© ruim", max: "Parece ruim mas √© gostoso" },
            { min: "Normal", max: "Estranho" },
            { min: "Her√≥i", max: "Vil√£o" },
            { min: "In√∫til em um apocalipse zumbi", max: "Essencial em um apocalipse zumbi" },
            { min: "In√∫til em uma ilha deserta", max: "Essencial em uma ilha deserta" },
            { min: "Cheira mal", max: "Cheira bem" },
            { min: "Acontece uma vez na vid", max: "Acontece todo dia" },
            { min: "D√° sono", max: "D√° adrenalina" },
            { min: "Nome de cachorro", max: "Nome de gente" }
        ];

        window.onload = function() {
            initScoreboard();
            drawScale(); 
            setTimeout(startNewRound, 100);
        };

        function drawScale() {
            const container = document.getElementById('ticks-container');
            container.innerHTML = ""; 
            
            for (let i = 0; i <= 100; i += 10) {
                const deg = (i / 100 * 180) - 90;
                const tick = document.createElement('div');
                tick.className = 'tick-mark';
                tick.style.transform = `translateX(-50%) rotate(${deg}deg)`;
                
                const num = document.createElement('div');
                num.className = 'tick-number';
                num.innerText = i;
                tick.appendChild(num);
                container.appendChild(tick);
            }
        }

        function moveNeedleByClick(event) {
            if(document.getElementById('btn-reveal').disabled) return;
            const rect = event.currentTarget.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            const centerX = rect.width / 2;
            const centerY = rect.height;
            const dx = x - centerX;
            const dy = centerY - y;
            const theta = Math.atan2(dy, dx);
            let degrees = theta * (180 / Math.PI);
            if (degrees < 0) degrees = 0;
            if (degrees > 180) degrees = 180;
            let value = 100 - (degrees / 180 * 100);
            value = Math.round(value / 5) * 5;
            if (value > 100) value = 100;
            if (value < 0) value = 0;
            updateNeedle(value);
            document.getElementById('dial-slider').value = value;
        }

        function updateNeedle(val) {
            const deg = (val / 100 * 180) - 90;
            document.getElementById('needle').style.transform = `translateX(-50%) rotate(${deg}deg)`;
            document.getElementById('display-val').innerText = val;
        }

        function startNewRound() {
            const overlay = document.getElementById('dim-overlay');
            overlay.style.opacity = '0';
            overlay.style.pointerEvents = 'none';

            // Limpa feedback de pontua√ß√£o
            document.getElementById('feedback-score').classList.remove('anim-pop');
            document.getElementById('feedback-score').style.opacity = '0';

            document.getElementById('gauge-main').classList.remove('spotlight-active');
            document.getElementById('btn-new').classList.remove('spotlight-active');
            document.getElementById('btn-new').style.display = 'none';

            updateNeedle(0);
            document.getElementById('dial-slider').value = 0;
            document.getElementById('btn-reveal').disabled = false;
            document.getElementById('dial-slider').disabled = false;
            document.getElementById('qr-container').style.opacity = "1";

            const step = Math.floor(Math.random() * 21);
            currentTarget = step * 5;
            
            const targetEl = document.getElementById('target-zone');
            targetEl.style.transition = 'none'; 
            targetEl.style.opacity = '0'; 
            targetEl.style.transform = "translateX(-50%) rotate(-90deg)"; 

            generateQRCode(`Alvo: ${currentTarget}`);
            shuffleTheme();
        }

        function revealAnimation() {
            document.getElementById('btn-reveal').disabled = true;
            document.getElementById('dial-slider').disabled = true;

            const overlay = document.getElementById('dim-overlay');
            overlay.style.opacity = '1';
            overlay.style.pointerEvents = 'all'; 

            document.getElementById('gauge-main').classList.add('spotlight-active');
            
            const targetEl = document.getElementById('target-zone');
            const finalDeg = (currentTarget / 100 * 180) - 90;

            targetEl.style.opacity = '1';
            
            targetEl.style.transition = "transform 0.6s ease-in-out";
            targetEl.style.transform = "translateX(-50%) rotate(-70deg)";

            setTimeout(() => {
                targetEl.style.transform = "translateX(-50%) rotate(70deg)";
            }, 600);

            setTimeout(() => {
                targetEl.style.transition = "transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)";
                targetEl.style.transform = `translateX(-50%) rotate(${finalDeg}deg)`;
            }, 1200);

            setTimeout(() => {
                document.getElementById('qr-container').innerHTML = "";
                document.getElementById('qr-container').style.minHeight = "120px"; 
                document.getElementById('qr-container').innerText = "FIM";

                const btnNew = document.getElementById('btn-new');
                btnNew.style.display = 'block';
                btnNew.classList.add('spotlight-active');
                
                checkScore(currentTarget);
                
            }, 2500);
        }

        // --- SISTEMA DE PONTUA√á√ÉO AJUSTADO ---
        function checkScore(target) {
            const userVal = parseInt(document.getElementById('dial-slider').value);
            const diff = Math.abs(target - userVal);
            const feedback = document.getElementById('feedback-score');
            
            feedback.classList.remove('anim-pop');
            void feedback.offsetWidth; 

            // +/- 5 unidades: +4 pontos
            if (diff <= 5) {
                feedback.innerText = "+4";
                feedback.style.color = "#ffd700";
                feedback.classList.add('anim-pop');
            } 
            // +/- 10 unidades: +2 pontos
            else if (diff <= 10) {
                feedback.innerText = "+2";
                feedback.style.color = "#ff9f1c";
                feedback.classList.add('anim-pop');
            }
        }

        function shuffleTheme() {
            const randomTheme = themes[Math.floor(Math.random() * themes.length)];
            document.getElementById('theme-0').innerText = randomTheme.min;
            document.getElementById('theme-100').innerText = randomTheme.max;
        }

        function generateQRCode(text) {
            const container = document.getElementById('qr-container');
            container.innerHTML = "";
            if (typeof QRCode !== 'undefined') {
                new QRCode(container, {
                    text: text,
                    width: 120,
                    height: 120,
                    colorDark : "#000000",
                    colorLight : "#ffffff",
                    correctLevel : QRCode.CorrectLevel.L
                });
            } else {
                setTimeout(() => generateQRCode(text), 500);
            }
        }

        // --- PLACAR ---
        function initScoreboard() {
            const board = document.getElementById('scoreboard');
            board.innerHTML = "";
            addTeam();
            addTeam();
            renderAddButton();
        }

        function addTeam() {
            teamCount++;
            const board = document.getElementById('scoreboard');
            const teamDiv = document.createElement('div');
            teamDiv.className = 'team-card';
            teamDiv.id = `team-card-${teamCount}`;
            teamDiv.innerHTML = `
                <button class="btn-remove-team" onclick="removeTeam(${teamCount})" title="Remover Equipe">‚úï</button>
                <div class="team-name" contenteditable="true" spellcheck="false">Time ${teamCount}</div>
                <div class="team-score" id="score-val-${teamCount}" contenteditable="true">0</div>
                <div class="score-controls">
                    <button class="btn-score" onclick="changeScore(${teamCount}, 2)" style="background:#ff9f1c; color:#000">+2</button>
                    <button class="btn-score" onclick="changeScore(${teamCount}, 4)" style="background:#ffd700; color:#000">+4</button>
                    <button class="btn-score" onclick="changeScore(${teamCount}, 1)" style="background:var(--blue-btn); color:#000">+1</button>
                </div>
            `;
            const btn = document.getElementById('btn-add-team');
            if(btn) board.insertBefore(teamDiv, btn);
            else board.appendChild(teamDiv);
        }

        function removeTeam(id) {
            const card = document.getElementById(`team-card-${id}`);
            if(card) card.remove();
        }

        function renderAddButton() {
            const board = document.getElementById('scoreboard');
            const existingBtn = document.getElementById('btn-add-team');
            if(existingBtn) existingBtn.remove();
            const btn = document.createElement('button');
            btn.id = 'btn-add-team';
            btn.className = 'btn-add-team';
            btn.innerHTML = '+';
            btn.title = "Adicionar Equipe";
            btn.onclick = function() { addTeam(); };
            board.appendChild(btn);
        }

        function changeScore(teamId, points) {
            const el = document.getElementById(`score-val-${teamId}`);
            let current = parseInt(el.innerText);
            if (isNaN(current)) current = 0;
            if(current + points >= 0) el.innerText = current + points;
        }
    </script>
</body>
</html>

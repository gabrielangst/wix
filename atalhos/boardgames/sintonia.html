<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sintonia - Championship Edition</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --panel-color: #16213e;
            --accent-color: #e94560;
            --secondary-zone: #ff9f1c;
            --text-color: #fff;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(rgba(10, 10, 20, 0.9), rgba(10, 10, 20, 0.9)), 
                        url('https://static.vecteezy.com/system/resources/previews/003/581/209/non_2x/hand-drawn-banner-template-of-board-game-vector.jpg');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: var(--text-color); display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; overflow-x: hidden; padding-bottom: 50px;
        }

        /* Gest√£o de Equipes (Topo) */
        #campeonato { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; background: rgba(0,0,0,0.8); padding: 10px; width: 100%; border-bottom: 2px solid #333; }
        .equipe-config { display: flex; align-items: center; gap: 5px; background: #222; padding: 5px 10px; border-radius: 8px; border: 1px solid #444; }
        .edit-nome { background: transparent; border: none; color: #f1c40f; font-weight: bold; width: 90px; text-align: center; }
        .vit-num { font-size: 1.2rem; font-weight: bold; color: #fff; background: #333; border: none; width: 40px; text-align: center; border-radius: 4px; }

        /* Interface da TV */
        h1 { margin: 15px 0; font-size: 1.8rem; color: var(--accent-color); text-transform: uppercase; letter-spacing: 2px; }
        .gauge-wrapper { position: relative; width: 600px; height: 300px; margin: 20px auto; cursor: pointer; }
        .gauge-bg { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background: #333; border-radius: 300px 300px 0 0; border: 5px solid #444; box-sizing: border-box; }
        
        .target-zone { position: absolute; bottom: 0; left: 50%; width: 600px; height: 300px; transform-origin: bottom center; opacity: 0; pointer-events: none; transform: translateX(-50%) rotate(-90deg); transition: 1.5s cubic-bezier(0.25, 1, 0.5, 1); }
        .wedge-outer { position: absolute; bottom: 0; left: 50%; width: 120px; height: 300px; background: var(--secondary-zone); transform: translateX(-50%); clip-path: polygon(0 0, 100% 0, 50% 100%); opacity: 0.8; }
        .wedge-inner { position: absolute; bottom: 0; left: 50%; width: 50px; height: 300px; background: #fff; transform: translateX(-50%); clip-path: polygon(0 0, 100% 0, 50% 100%); }
        
        .needle { position: absolute; bottom: 0; left: 50%; width: 4px; height: 260px; background: #fff; transform-origin: bottom center; transform: translateX(-50%) rotate(-90deg); z-index: 10; border-radius: 2px; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
        .needle-knob { position: absolute; bottom: -15px; left: 50%; width: 30px; height: 30px; background: #fff; border-radius: 50%; transform: translateX(-50%); z-index: 11; border: 4px solid var(--accent-color); }

        .tick-mark { position: absolute; bottom: 0; left: 50%; width: 2px; height: 280px; transform-origin: bottom center; border-top: 15px solid rgba(255,255,255,0.2); }
        .tick-number { position: absolute; top: -25px; left: -15px; width: 30px; text-align: center; font-size: 0.8rem; color: #888; }

        /* Controles */
        .controls { background: var(--panel-color); padding: 20px; border-radius: 20px; width: 90%; max-width: 700px; margin-top: 10px; }
        .slider { width: 100%; cursor: pointer; accent-color: var(--accent-color); margin: 20px 0; }
        
        #theme-box { display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; border: 1px solid #444; }
        .theme-side { flex: 1; text-align: center; }
        .theme-val { font-size: 1.2rem; font-weight: bold; display: block; }
        
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.2s; }
        .btn-reveal { background: var(--accent-color); color: white; }
        .btn-next { background: #4ecca3; color: #1a1a2e; }
        .btn-sync { background: #555; color: white; font-size: 0.7rem; padding: 5px 10px; }

        #qrcode { background: white; padding: 8px; border-radius: 8px; display: inline-block; margin-top: 10px; }

        /* Mobile */
        .remote-card { background: var(--panel-color); padding: 40px; border-radius: 30px; text-align: center; width: 85%; max-width: 400px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        #secret-val { font-size: 6rem; font-weight: 900; color: var(--accent-color); margin: 20px 0; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="campeonato">
        <div id="lista-equipes-config"></div>
        <button onclick="adicionarEquipe()" style="background:#444; color:white; border:none; border-radius:50%; width:30px; height:30px; cursor:pointer">+</button>
    </div>

    <div id="tela-tv">
        <h1>SINTONIA</h1>
        
        <div class="gauge-wrapper" onclick="moveByClick(event)">
            <div class="gauge-bg"></div>
            <div id="ticks-container"></div>
            <div id="target-zone" class="target-zone">
                <div class="wedge-outer"></div>
                <div class="wedge-inner"></div>
            </div>
            <div id="needle" class="needle"></div>
            <div class="needle-knob"></div>
        </div>

        <div class="controls">
            <div id="theme-box">
                <div class="theme-side"><small style="color:var(--accent-color)">0</small><span id="theme-0" class="theme-val">...</span></div>
                <button onclick="shuffleTheme()" title="Trocar Tema" style="background:none; border:none; font-size:1.5rem; cursor:pointer; color:#888;">üîÑ</button>
                <div class="theme-side"><small style="color:var(--accent-color)">100</small><span id="theme-100" class="theme-val">...</span></div>
            </div>

            <input type="range" class="slider" id="dial" min="0" max="100" value="50" oninput="updateNeedle(this.value)">
            
            <div style="display:flex; justify-content:center; gap:15px;">
                <button class="btn btn-reveal" id="btn-reveal" onclick="revealAlvo()">üëÅÔ∏è Revelar Alvo</button>
                <button class="btn btn-next" id="btn-next" onclick="proximaRodada()" style="display:none;">üé≤ Pr√≥xima Rodada</button>
            </div>

            <div style="margin-top:20px;">
                <div id="qrcode"></div>
                <p style="font-size:0.7rem; color:#666;">Capit√£o: Escaneie para ver o Alvo Secreto</p>
            </div>
        </div>
    </div>

    <div id="tela-celular" class="hidden">
        <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh;">
            <div class="remote-card">
                <p>O ALVO DA RODADA √â:</p>
                <div id="secret-val">--</div>
                <button class="btn btn-reveal" style="width:100%" onclick="window.minhaConexao.send({type:'REVELAR'})">üì¢ MOSTRAR NA TV</button>
            </div>
        </div>
    </div>

<script>
    let peer, conn, currentTarget = 50, wakeLock = null;
    let equipes = [
        { nome: 'TIME A', pontos: 0, cor: '#e94560' },
        { nome: 'TIME B', pontos: 0, cor: '#4ecca3' }
    ];

    const themesBase = [
        { min: "Cidade Ruim", max: "Cidade Incr√≠vel" }, { min: "Comida Ruim", max: "Comida Gostosa" },
        { min: "Superpoder In√∫til", max: "Superpoder Incr√≠vel" }, { min: "Animal Inofensivo", max: "Animal Letal" },
        { min: "M√∫sica Triste", max: "M√∫sica Feliz" }, { min: "Fetiche Comum", max: "Fetiche Estranho" },
        { min: "Hobby Barato", max: "Hobby Caro" }, { min: "Emoji In√∫til", max: "Emoji Indispens√°vel" },
        { min: "Filme de Sess√£o da Tarde", max: "Obra-prima do Cinema" }, { min: "Trabalho Chato", max: "Trabalho dos Sonhos" },
        { min: "Vil√£o que tem raz√£o", max: "Vil√£o puramente mau" }, { min: "Inven√ß√£o In√∫til", max: "Mudou a humanidade" },
        { min: "Desenho para Crian√ßa", max: "Desenho para Adulto" }, { min: "Ator de um papel s√≥", max: "Camale√£o do Cinema" },
        { min: "Sabor de Pizza Pol√™mico", max: "Unanimidade Nacional" }, { min: "Pa√≠s subestimado", max: "Pa√≠s superestimado" },
        { min: "Rede Social T√≥xica", max: "Rede Social Saud√°vel" }, { min: "Tend√™ncia de moda feia", max: "Moda Atemporal" },
        { min: "Estilo Musical Irritante", max: "M√∫sica Relaxante" }, { min: "Personalidade de Reality", max: "L√≠der Mundial" },
        { min: "Presente de Grego", max: "Melhor Presente do Mundo" }, { min: "Habilidade que ningu√©m liga", max: "Talento √önico" },
        { min: "Destino de viagem clich√™", max: "Lugar Ex√≥tico" }, { min: "Marca Barata", max: "Marca de Luxo" },
        { min: "Objeto que quebra f√°cil", max: "Indestrut√≠vel" }, { min: "Palavra dif√≠cil de falar", max: "Satisfat√≥ria de dizer" },
        { min: "Lugar que cheira mal", max: "Perfume Natural" }, { min: "Acess√≥rio Brega", max: "Acess√≥rio Elegante" },
        { min: "Famoso "esquec√≠vel"", max: "√çcone Eterno" }, { min: "Ferramenta de Cozinha In√∫til", max: "M√£o na Roda" },
        { min: "Site da Web de 1990", max: "Interface Futurista" }, { min: "Meme Datado", max: "Meme Imortal" },
        { min: "Sabor de sorvete b√°sico", max: "Sabor Gourmet" }, { min: "Esporte tedioso", max: "Pura Adrenalina" },
        { min: "Assunto de conversa fiada", max: "Deep Talk" }, { min: "Livro de Autoajuda", max: "Literatura Cl√°ssica" },
        { min: "App que drena bateria", max: "App Otimizado" }, { min: "Atitude Imatura", max: "Atitude S√°bia" },
        { min: "Cantor de Chuveiro", max: "Voz Angelical" }, { min: "Sobremesa Enjoativa", max: "Equil√≠brio de Sabores" },
        { min: "Vil√£o de Desenho Animado", max: "Ditador Hist√≥rico" }, { min: "Tecnologia Obsoleta", max: "Ponta de Linha" },
        { min: "Animal Fofinho", max: "Animal Bizarro" }, { min: "Clima Depressivo", max: "Dia Perfeito" },
        { min: "Fruta Sem Gra√ßa", max: "Explos√£o de Sabor" }, { min: "Profiss√£o Perigosa", max: "Trabalho Seguro" },
        { min: "G√≠ria de "Tioz√£o"", max: "Linguagem da Gen Z" }, { min: "Bebida que desce queimando", max: "Suave como seda" },
        { min: "Personagem de Game Fraco", max: "Boss Apel√£o" }, { min: "Lugar Barulhento", max: "Sil√™ncio Absoluto" },
        { min: "Pe√ßa de Roupa Desconfort√°vel", max: "Segunda Pele" }, { min: "Com√©dia sem gra√ßa", max: "Morrer de rir" },
        { min: "Talento In√∫til em uma Ilha Deserta", max: "Habilidade de Sobreviv√™ncia" }, { min: "Pior pesadelo", max: "Sonho L√∫cido" },
        { min: "Conselho de Pai", max: "Filosofia Grega" }, { min: "Pessoa Irrelevante", max: "Protagonista da Hist√≥ria" },
        { min: "Dica de Sa√∫de Duvidosa", max: "Ci√™ncia Comprovada" }, { min: "Objeto que voc√™ perde sempre", max: "Sempre √† m√£o" },
        { min: "Can√ß√£o de Ninar", max: "Heavy Metal" }, { min: "Tiro curto (One Hit Wonder)", max: "Carreira S√≥lida" },
        { min: "Cachorro de dondoca", max: "Lobo Selvagem" }, { min: "Refrigerante sem g√°s", max: "Champanhe Gelada" },
        { min: "Conversa de Elevador", max: "Terapia Intensiva" }, { min: "Eletrodom√©stico que faz barulho", max: "Silencioso" },
        { min: "Pior √©poca para viver", max: "Era de Ouro" }, { min: "Cor de Parede Depressiva", max: "Ambiente Vibrante" },
        { min: "Presente de Amigo Oculto", max: "Heran√ßa de Fam√≠lia" }, { min: "Ator de Comercial", max: "Ganhador de Oscar" },
        { min: "Lanche de Posto", max: "Banquete Real" }, { min: "Lugar que d√° medo", max: "Santu√°rio" },
        { min: "Regra Chatas", max: "Liberdade Total" }, { min: "Som Irritante", max: "ASMR Relaxante" },
        { min: "Habilidade de DIY (Fa√ßa voc√™ mesmo) Ruim", max: "Mestre de Obras" }, { min: "S√©rie que "se arrasta"", max: "Ritmo Fren√©tico" },
        { min: "Lugar para levar a sogra", max: "Lugar para Lua de Mel" }, { min: "Personagem secund√°rio", max: "Lenda do Jogo" },
        { min: "Cheiro de limpeza", max: "Cheiro de Natureza" }, { min: "Jogo que estraga amizades", max: "Jogo que une a galera" },
        { min: "Mentira Inocente", max: "Conspira√ß√£o Mundial" }, { min: "Atitude Ego√≠sta", max: "Altru√≠smo Puro" },
        { min: "Carro de Colecionador", max: "Lata Velha" }, { min: "Festa de Crian√ßa", max: "Rave" },
        { min: "Segredo bobo", max: "Confiss√£o de Crime" }, { min: "Pessoa Normal", max: "Alien√≠gena Disfar√ßado" },
        { min: "Futebol de V√°rzea", max: "Final de Copa do Mundo" }, { min: "Culin√°ria Ex√≥tica", max: "Comida de M√£e" },
        { min: "Estrela Mirim", max: "Veterano de Guerra" }, { min: "Clich√™ de Terror", max: "Reviravolta Genial" },
        { min: "Hobby que d√° sono", max: "V√≠cio" }, { min: "Marca de Grife", max: "Produto de Feira" },
        { min: "Dica de Viagem Ruim", max: "Guia Local" }, { min: "M√∫sica de r√°dio", max: "Lado B Alternativo" },
        { min: "Brinquedo de Pl√°stico", max: "Objeto de Arte" }, { min: "Cidade do Interior", max: "Metr√≥pole Global" },
        { min: "Dia de Segunda-feira", max: "Sextou!" }, { min: "Sentimento Passageiro", max: "Amor Eterno" }
    ];

    let themesPool = [...themesBase];

    async function ativarWakeLock() {
        try { if ('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen'); } catch(e){}
    }
    ativarWakeLock();

    function drawScale() {
        const cont = document.getElementById('ticks-container');
        cont.innerHTML = '';
        for(let i=0; i<=100; i+=10) {
            const t = document.createElement('div');
            t.className = 'tick-mark';
            t.style.transform = `translateX(-50%) rotate(${(i/100*180)-90}deg)`;
            t.innerHTML = `<div class="tick-number">${i}</div>`;
            cont.appendChild(t);
        }
    }

    function shuffleTheme() {
        if(themesPool.length === 0) themesPool = [...themesBase];
        const idx = Math.floor(Math.random() * themesPool.length);
        const t = themesPool.splice(idx, 1)[0];
        document.getElementById('theme-0').innerText = t.min;
        document.getElementById('theme-100').innerText = t.max;
    }

    function proximaRodada() {
        document.getElementById('btn-next').style.display = 'none';
        document.getElementById('btn-reveal').style.display = 'inline-block';
        document.getElementById('target-zone').style.opacity = '0';
        currentTarget = (Math.floor(Math.random() * 19) + 1) * 5; // Evita 0 e 100 absolutos
        updateNeedle(50);
        shuffleTheme();
        if(conn) conn.send({type: 'ALVO', valor: currentTarget});
    }

    function revealAlvo() {
        document.getElementById('btn-reveal').style.display = 'none';
        const tz = document.getElementById('target-zone');
        tz.style.opacity = '1';
        tz.style.transform = `translateX(-50%) rotate(${(currentTarget/100*180)-90}deg)`;
        setTimeout(() => { document.getElementById('btn-next').style.display = 'inline-block'; }, 1500);
    }

    function updateNeedle(v) {
        document.getElementById('needle').style.transform = `translateX(-50%) rotate(${(v/100*180)-90}deg)`;
        document.getElementById('dial').value = v;
    }

    function moveByClick(e) {
        const rect = e.currentTarget.getBoundingClientRect();
        const x = e.clientX - rect.left - (rect.width/2);
        const y = rect.height - (e.clientY - rect.top);
        let angle = Math.atan2(y, x) * 180 / Math.PI;
        let val = 100 - (angle / 180 * 100);
        updateNeedle(Math.round(Math.max(0, Math.min(100, val))));
    }

    function adicionarEquipe() {
        equipes.push({ nome: 'NOVO TIME', pontos: 0, cor: '#888' });
        renderEquipes();
    }

    function renderEquipes() {
        const config = document.getElementById('lista-equipes-config');
        config.innerHTML = '';
        equipes.forEach((eq, i) => {
            config.innerHTML += `
                <div class="equipe-config">
                    <input type="text" class="edit-nome" value="${eq.nome}" onchange="equipes[${i}].nome=this.value">
                    <input type="number" class="vit-num" value="${eq.pontos}" onchange="equipes[${i}].pontos=parseInt(this.value)">
                </div>`;
        });
    }

    function iniciarTV() {
        peer = new Peer();
        peer.on('open', id => {
            const url = window.location.href.split('?')[0] + '?sala=' + id;
            new QRCode(document.getElementById("qrcode"), { text: url, width: 120, height: 120 });
            drawScale(); renderEquipes(); proximaRodada();
        });
        peer.on('connection', c => {
            conn = c;
            conn.on('data', d => { if(d.type==='REVELAR') revealAlvo(); });
            setTimeout(() => conn.send({type: 'ALVO', valor: currentTarget}), 1000);
        });
    }

    function iniciarCelular(salaId) {
        document.getElementById('tela-tv').classList.add('hidden');
        document.getElementById('campeonato').classList.add('hidden');
        document.getElementById('tela-celular').classList.remove('hidden');
        peer = new Peer();
        peer.on('open', () => {
            const c = peer.connect(salaId);
            c.on('data', d => { if(d.type==='ALVO') document.getElementById('secret-val').innerText = d.valor; });
            window.minhaConexao = c;
        });
    }

    const salaId = new URLSearchParams(window.location.search).get('sala');
    if(salaId) iniciarCelular(salaId); else iniciarTV();
</script>
</body>
</html>

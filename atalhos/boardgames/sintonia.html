<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sintonia - Controle Remoto Oficial</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --bg-color: #1a1a2e;
            --panel-color: #16213e;
            --accent-color: #e94560;
            --secondary-zone: #ff9f1c;
            --text-color: #fff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(rgba(10, 10, 20, 0.8), rgba(10, 10, 20, 0.8)), 
                        url('https://static.vecteezy.com/system/resources/previews/003/581/209/non_2x/hand-drawn-banner-template-of-board-game-vector.jpg');
            background-size: cover; background-position: center; background-attachment: fixed;
            color: var(--text-color); display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; user-select: none; overflow-x: hidden; padding-bottom: 50px;
        }

        /* TELA CELULAR */
        .remote-container { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; width: 100%; background: #1a1a2e; text-align: center; }
        .remote-card { background: #16213e; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 85%; max-width: 400px; }
        #secret-val { font-size: 7rem; font-weight: 900; color: var(--accent-color); margin: 20px 0; }
        .btn-send-tv { background: #4ecca3; color: #1a1a2e; border: none; padding: 20px; border-radius: 15px; font-size: 1.2rem; font-weight: bold; cursor: pointer; width: 100%; }

        /* TABULEIRO TV */
        h1 { margin: 20px 0 10px; font-size: 2rem; text-transform: uppercase; color: var(--accent-color); text-shadow: 0 0 15px rgba(233, 69, 96, 0.3); }
        
        /* Removido o overlay escuro e adicionado apenas um efeito de foco */
        .spotlight-active { filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.15)); z-index: 100; }
        
        #feedback-score { position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%) scale(0); font-size: 8rem; font-weight: 900; z-index: 200; opacity: 0; text-shadow: 0 0 20px #000; color: #f1c40f; }
        .anim-pop { animation: popIn 1.5s forwards; }
        @keyframes popIn { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; } 100% { transform: translate(-50%, -60%) scale(1); opacity: 0; } }
        
        .gauge-wrapper { position: relative; width: 640px; height: 320px; margin: 30px auto 0; transition: filter 0.5s ease; }
        .gauge-bg { position: absolute; bottom: 0; left: 20px; width: 600px; height: 300px; background: linear-gradient(90deg, #ff4d4d 0%, #ffff00 50%, #4dff4d 100%); border-radius: 300px 300px 0 0; opacity: 0.2; }
        .tick-mark { position: absolute; bottom: 0; left: 50%; width: 2px; height: 310px; transform-origin: bottom center; border-top: 10px solid rgba(255,255,255,0.4); pointer-events: none; }
        .tick-number { position: absolute; top: -30px; left: -20px; width: 40px; text-align: center; font-size: 1rem; font-weight: bold; text-shadow: 0 2px 4px #000; }
        
        .target-zone { position: absolute; bottom: 0; left: 50%; width: 600px; height: 300px; transform-origin: bottom center; opacity: 0; pointer-events: none; transform: translateX(-50%) rotate(-90deg); z-index: 3; }
        .wedge-outer { position: absolute; bottom: 0; left: 50%; width: 208px; height: 320px; background-color: var(--secondary-zone); transform: translateX(-50%); clip-path: polygon(0 0, 100% 0, 50% 100%); opacity: 0.8; }
        .wedge-inner { position: absolute; bottom: 0; left: 50%; width: 101px; height: 320px; background-color: #fff; transform: translateX(-50%); clip-path: polygon(0 0, 100% 0, 50% 100%); }
        
        .needle { position: absolute; bottom: 0; left: 50%; width: 6px; height: 280px; background: #fff; border: 2px solid #000; transform-origin: bottom center; transform: translateX(-50%) rotate(-90deg); z-index: 10; border-radius: 3px; }
        .needle-knob { position: absolute; bottom: -25px; left: 50%; width: 50px; height: 50px; background: #fff; border: 4px solid var(--accent-color); border-radius: 50%; transform: translateX(-50%); z-index: 11; }
        
        .controls-area { background: var(--panel-color); padding: 15px 30px; border-radius: 15px; width: 90%; max-width: 800px; text-align: center; margin-top: 5px; box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
        .range-slider { width: 100%; cursor: pointer; accent-color: var(--accent-color); }
        #qr-container { background: white; padding: 10px; border-radius: 10px; display: inline-block; cursor: pointer; }
        
        .scoreboard { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 20px; }
        .team-card { background: rgba(255,255,255,0.08); padding: 10px; border-radius: 8px; min-width: 140px; text-align: center; border: 1px solid rgba(255,255,255,0.15); transition: 0.3s; }
        .active-turn { border: 2px solid var(--accent-color); background: rgba(233, 69, 96, 0.1); transform: scale(1.05); }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="tela-tv">
        <div id="feedback-score"></div>
        <h1>Sintonia Online</h1>
        <div class="gauge-wrapper" id="gauge-main" onclick="moveByClick(event)">
            <div class="gauge-bg"></div>
            <div id="ticks-container"></div> 
            <div id="target-zone" class="target-zone">
                <div class="wedge-outer"></div>
                <div class="wedge-inner"></div>
            </div>
            <div id="needle" class="needle"></div>
            <div class="needle-knob"></div>
        </div>
        <div class="controls-area">
            <p style="font-size: 1.2rem;">Posi√ß√£o: <span id="display-val" style="color:var(--accent-color); font-weight:bold;">0</span></p>
            <input type="range" id="dial-slider" class="range-slider" min="0" max="100" value="0" step="5" oninput="updateNeedle(this.value)">
            <div style="margin: 15px 0; height: 50px;">
                <button onclick="revealAnimation()" id="btn-reveal" style="background:var(--accent-color); color:white; padding:12px 30px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; font-size:1.1rem;">üëÅÔ∏è Revelar</button>
                <button onclick="startNewRound()" id="btn-new" style="background:#4ecca3; color:#1a1a2e; padding:12px 30px; border:none; border-radius:8px; cursor:pointer; font-weight:bold; font-size:1.1rem; display:none;">üé≤ Nova Rodada</button>
            </div>
            <div id="info-section" style="display:flex; justify-content:center; align-items:center; gap:25px;">
                <div id="qr-container" onclick="window.open(currentUrl, '_blank')"></div>
                <div id="theme-display" style="text-align:left; background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; border: 1px solid rgba(255,255,255,0.1); min-width: 250px;">
                    <div style="color:#888; font-size:0.8rem; margin-bottom:5px; font-weight:bold;">TEMA DA RODADA:</div>
                    <div style="font-size:1.1rem; margin-bottom:3px;"><span style="color:var(--accent-color); font-weight:bold;">0:</span> <span id="theme-0">...</span></div>
                    <div style="font-size:1.1rem;"><span style="color:var(--accent-color); font-weight:bold;">100:</span> <span id="theme-100">...</span></div>
                </div>
            </div>
        </div>
        <div class="scoreboard" id="scoreboard"></div>
    </div>

    <div id="tela-celular" class="hidden">
        <div class="remote-container">
            <div class="remote-card" id="card-remoto">
                <h2 style="color:var(--accent-color); margin-top:0;">SINTONIA</h2>
                <p>O seu alvo da rodada √©:</p>
                <div id="secret-val">--</div>
                <button class="btn-send-tv" onclick="comandoRevelar()">üì¢ REVELAR NO TEL√ÉO</button>
            </div>
            <div id="msg-bloqueio" class="hidden">
                <div class="remote-card">
                    <p style="color:#4ecca3; font-weight:bold; font-size:1.2rem;">Sucesso!</p>
                    <p style="color:#888; font-style:italic;">O alvo foi revelado na TV. <br> Agora aguarde o pr√≥ximo jogador.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let peer, conn, currentTarget = 0, currentUrl = "", autoTimer = null;
        let currentTurnIndex = 0;
        const themes = [
            { min: "Cidade ruim", max: "Cidade incr√≠vel" }, { min: "Comida ruim", max: "Comida gostosa" },
            { min: "Superpoder in√∫til", max: "Superpoder incr√≠vel" }, { min: "Animal inofensivo", max: "Animal letal" },
            { min: "M√∫sica triste", max: "M√∫sica feliz" }, { min: "Cheiro ruim", max: "Cheiro maravilhoso" },
            { min: "Coisa de rico", max: "Coisa de pobre" }, { min: "Chato", max: "Divertido" },
            { min: "Fraco", max: "Poderoso" }, { min: "Curto", max: "Longo" }
        ];

        window.onload = () => {
            const salaId = new URLSearchParams(window.location.search).get('sala');
            if (salaId) iniciarCelular(salaId); else iniciarTV();
        };

        function iniciarTV() {
            peer = new Peer();
            peer.on('open', (id) => {
                currentUrl = window.location.href.split('?')[0] + '?sala=' + id;
                document.getElementById('qr-container').innerHTML = '';
                new QRCode(document.getElementById("qr-container"), { text: currentUrl, width: 100, height: 100 });
                drawScale(); initScoreboard(); startNewRound();
            });
            peer.on('connection', (c) => {
                conn = c;
                conn.on('open', () => conn.send({ type: 'ALVO', valor: currentTarget }));
                conn.on('data', (d) => { if(d.type === 'REVELAR') revealAnimation(); });
            });
        }

        function iniciarCelular(id) {
            document.getElementById('tela-tv').classList.add('hidden');
            document.getElementById('tela-celular').classList.remove('hidden');
            peer = new Peer();
            peer.on('open', () => {
                const c = peer.connect(id);
                c.on('data', (d) => { if(d.type === 'ALVO') document.getElementById('secret-val').innerText = d.valor; });
                window.minhaConexao = c;
            });
        }

        function comandoRevelar() {
            if(window.minhaConexao) {
                window.minhaConexao.send({ type: 'REVELAR' });
                document.getElementById('card-remoto').classList.add('hidden');
                document.getElementById('msg-bloqueio').classList.remove('hidden');
            }
        }

        function startNewRound() {
            if(autoTimer) clearInterval(autoTimer);
            document.getElementById('btn-new').style.display = 'none';
            document.getElementById('btn-reveal').style.display = 'inline-block';
            document.getElementById('gauge-main').classList.remove('spotlight-active');
            document.getElementById('target-zone').style.opacity = '0';
            document.getElementById('target-zone').style.transform = "translateX(-50%) rotate(-90deg)";
            
            currentTarget = Math.floor(Math.random() * 21) * 5;
            updateNeedle(0);
            shuffleTheme();
            
            const cards = document.querySelectorAll('.team-card');
            if(cards.length > 0) {
                cards.forEach(c => c.classList.remove('active-turn'));
                cards[currentTurnIndex].classList.add('active-turn');
                currentTurnIndex = (currentTurnIndex + 1) % cards.length;
            }
        }

        function revealAnimation() {
            document.getElementById('btn-reveal').style.display = 'none';
            document.getElementById('gauge-main').classList.add('spotlight-active');
            
            const targetEl = document.getElementById('target-zone');
            const deg = (currentTarget / 100 * 180) - 90;
            targetEl.style.opacity = '1';
            targetEl.style.transition = "transform 1.2s cubic-bezier(0.22, 1, 0.36, 1)";
            targetEl.style.transform = `translateX(-50%) rotate(${deg}deg)`;

            setTimeout(() => {
                checkScore();
                document.getElementById('btn-new').style.display = 'inline-block';
                let time = 5;
                document.getElementById('btn-new').innerText = `üé≤ Nova Rodada (${time}s)`;
                autoTimer = setInterval(() => {
                    time--;
                    document.getElementById('btn-new').innerText = `üé≤ Nova Rodada (${time}s)`;
                    if(time <= 0) startNewRound();
                }, 1000);
            }, 1500);
        }

        function updateNeedle(val) {
            document.getElementById('needle').style.transform = `translateX(-50%) rotate(${(val/100*180)-90}deg)`;
            document.getElementById('display-val').innerText = val;
            document.getElementById('dial-slider').value = val;
        }

        function moveByClick(e) {
            const rect = document.getElementById('gauge-main').getBoundingClientRect();
            const x = e.clientX - rect.left - (rect.width/2);
            const y = rect.height - (e.clientY - rect.top);
            let val = 100 - (Math.atan2(y, x) * 180 / Math.PI / 180 * 100);
            updateNeedle(Math.round(Math.max(0, Math.min(100, val)) / 5) * 5);
        }

        function checkScore() {
            const diff = Math.abs(currentTarget - document.getElementById('dial-slider').value);
            if(diff <= 10) {
                const f = document.getElementById('feedback-score');
                f.innerText = diff <= 5 ? "+4" : "+2";
                f.classList.add('anim-pop');
                setTimeout(() => f.classList.remove('anim-pop'), 1500);
            }
        }

        function shuffleTheme() {
            const t = themes[Math.floor(Math.random() * themes.length)];
            document.getElementById('theme-0').innerText = t.min;
            document.getElementById('theme-100').innerText = t.max;
        }

        function drawScale() {
            const container = document.getElementById('ticks-container');
            container.innerHTML = '';
            for (let i = 0; i <= 100; i += 10) {
                const tick = document.createElement('div');
                tick.className = 'tick-mark';
                tick.style.transform = `translateX(-50%) rotate(${(i/100*180)-90}deg)`;
                tick.innerHTML = `<div class="tick-number">${i}</div>`;
                container.appendChild(tick);
            }
        }

        function initScoreboard() {
            const sb = document.getElementById('scoreboard');
            sb.innerHTML = `
                <div class="team-card">Time 1<div style="font-size:2rem; color:var(--accent-color); font-weight:bold;">0</div></div>
                <div class="team-card">Time 2<div style="font-size:2rem; color:var(--accent-color); font-weight:bold;">0</div></div>
            `;
        }
    </script>
</body>
</html>

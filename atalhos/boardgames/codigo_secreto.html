<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Código Secreto - Championship Final</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        
        body { 
            font-family: 'Segoe UI', sans-serif; 
            /* Adiciona a imagem com um degradê preto por cima para escurecer */
            background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)), 
                        url('https://ngm.com.au/wp-content/uploads/2025/03/ICAC-Investigations.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed; /* Mantém o fundo parado ao rolar */
            color: white; 
            text-align: center; 
            margin: 0; 
            overflow-x: hidden; 
            min-height: 100vh;
        }

        /* Placar Permanente TV (Barra Preta) */
        #campeonato { display: flex; justify-content: center; gap: 40px; background: #000; padding: 10px; border-bottom: 2px solid #444; }
        .vit-label { font-size: 0.9rem; color: #888; text-transform: uppercase; }
        .vit-num { font-size: 1.8rem; font-weight: bold; margin-left: 10px; color: #fff; background: transparent; border: none; width: 50px; text-align: center; cursor: pointer; }
        .vit-num:focus { background: #333; outline: none; border-radius: 4px; }

        /* Estilo do anúncio dinâmico */
        #aviso-inicio { font-weight: bold; margin: 10px 0; text-transform: uppercase; letter-spacing: 1px; height: 25px; font-size: 1.1rem; }
        .txt-azul { color: #00a8ff; text-shadow: 0 0 10px rgba(0, 168, 255, 0.5); }
        .txt-vermelho { color: #ff8fa3; text-shadow: 0 0 10px rgba(232, 65, 24, 0.5); }

        #tabuleiro { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 10px; max-width: 850px; margin: 0 auto; }
        .card { height: 80px; display: flex; align-items: center; justify-content: center; background: #dcdde1; color: #2f3640; 
                font-weight: bold; border-radius: 8px; text-transform: uppercase; font-size: 0.9rem; transition: 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); position: relative; }
        
        /* Efeito de destaque ao selecionar no celular */
        .foco-selecao { 
            border: 4px solid #f1c40f !important; 
            box-shadow: 0 0 25px #f1c40f !important;
            transform: scale(1.08);
            z-index: 10;
        }

        .revelando { animation: pulse 0.5s ease-out; }
        @keyframes pulse { 50% { transform: scale(1.1); box-shadow: 0 0 20px #fff; } }

        .azul { background: #00a8ff !important; color: white; }
        .vinho { background: #800020 !important; color: white; } 
        .neutro { background: #fbc531 !important; color: #2f3640; }
        .preto { background: #000 !important; color: white; border: 2px solid #800020; }

        #container-placares { display: flex; justify-content: center; gap: 30px; padding: 10px; }
        .time-box { background: #2f3640; padding: 10px; border-radius: 12px; min-width: 150px; border-bottom: 6px solid #555; }
        .label-azul { font-size: 0.8rem; color: #74ccff; font-weight: bold; }
        .label-vermelho { font-size: 0.8rem; color: #ff8fa3; font-weight: bold; }
        .score-atual { font-size: 2.2rem; font-weight: bold; font-family: monospace; color: white; }

        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); 
                   display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; transition: background 0.5s ease; }
        
        .btn-menu { background: #f1c40f; color: #000; border: none; padding: 12px 25px; font-weight: bold; border-radius: 5px; cursor: pointer; margin: 5px; text-transform: uppercase; }
        .btn-reset-global { background: #2ecc71; color: #fff; border: none; padding: 15px 40px; font-size: 1.1rem; font-weight: bold; border-radius: 50px; cursor: pointer; margin-top: 10px; box-shadow: 0 6px 0 #27ae60; text-transform: uppercase; }
        
        #qrcode { background: white; padding: 8px; display: inline-block; border-radius: 5px; margin-bottom: 5px; cursor: pointer; }
        .hidden { display: none; }
        
        /* --- ESTILO CAPITÃO (CELULAR) --- */
        #cap-campeonato { background: transparent; padding: 15px; display: flex; justify-content: center; gap: 30px; font-size: 1.1rem; }
        .cap-vit { font-weight: bold; }
        .cap-azul { color: #00a8ff; }
        .cap-vermelho { color: #ff8fa3; }
        .gabarito-card { opacity: 0.6; height: 60px !important; font-size: 0.7rem !important; margin: 2px; }
        .revelada-cap { opacity: 1; border: 2px solid gold; transform: scale(0.95); pointer-events: none; }
    </style>
</head>
<body>

    <div id="campeonato">
        <div><span class="vit-label">Vitórias Azul</span><input type="number" id="v-azul" class="vit-num" value="0" onchange="sincronizarPlacarManual()"></div>
        <div><span class="vit-label">Vitórias Vermelho</span><input type="number" id="v-vinho" class="vit-num" value="0" onchange="sincronizarPlacarManual()"></div>
    </div>

    <div id="overlay">
        <h2 id="msg-fim" style="font-size: 3.5rem; text-shadow: 2px 2px 10px rgba(0,0,0,0.5); margin: 0;">FIM DE JOGO</h2>
        <div id="pergunta-vencedor" class="hidden">
            <p style="font-size: 1.5rem;">O Assassino foi revelado! Quem venceu?</p>
            <button class="btn-menu" style="background:#00a8ff; color:white;" onclick="registrarVitoria('azul')">TIME AZUL</button>
            <button class="btn-menu" style="background:#800020; color:white; border-bottom: 4px solid #4d0013;" onclick="registrarVitoria('vinho')">TIME VERMELHO</button>
        </div>
        <div id="aviso-vitoria" class="hidden">
            <h3 id="texto-vitoria" style="font-size: 2.5rem; margin: 20px 0;"></h3>
        </div>
        <br>
        <button class="btn-reset-global" onclick="gerarNovaRodada()">PRÓXIMA RODADA</button>
    </div>

    <div id="tela-tv">
        <h1 style="margin:5px 0; font-size:1.5rem; color:#f1c40f">CÓDIGO SECRETO</h1>
        <div id="aviso-inicio"></div>
        <div id="tabuleiro"></div>
        <div id="container-placares">
            <div class="time-box" style="border-color: #00a8ff;">
                <div class="label-azul">TIME AZUL</div>
                <span id="score-azul" class="score-atual">0/0</span>
            </div>
            <div class="time-box" style="border-color: #800020;">
                <div class="label-vermelho">TIME VERMELHO</div>
                <span id="score-vinho" class="score-atual">0/0</span>
            </div>
        </div>
        <div id="controles">
            <button class="btn-reset-global" onclick="gerarNovaRodada()">Nova Rodada / Sorteio</button>
            <br><br>
            <div id="qrcode" onclick="abrirLinkTeste()"></div>
            <p style="font-size: 0.6rem; margin: 0; color: #888;">Capitães: Escaneiem (ou clique) o QR Code</p>
        </div>
    </div>

    <div id="tela-capitao" class="hidden">
        <div id="cap-campeonato">
            <span class="cap-azul">Azul: <b id="cap-v-azul" class="cap-vit">0</b></span>
            <span class="cap-vermelho">Vermelho: <b id="cap-v-vinho" class="cap-vit">0</b></span>
        </div>
        <div id="tabuleiro-capitao" style="display: grid; grid-template-columns: repeat(5, 1fr); padding: 5px;"></div>
    </div>

<script>
    const palavrasBanco = ["MARTELO", "ESPELHO", "CADEIRA", "LÂMPADA", "TAPETE", "ESCOVA", "TOALHA", "GARFO", "PANELA", "CHAVE", "ALMOFADA", "RELOGIO", "BALDE", "VASSOURA", "QUADRO", "JANELA", "PORTA", "GAVETA", "ESTANTE", "CORTINA", "FOGÃO", "XÍCARA", "PRATO", "SOFÁ", "COLCHÃO", "TRAVESSEIRO", "MALETA", "TESOURA", "CANETA", "CADERNO", "MOCHILA", "CARTEIRA", "CELULAR", "TABLET", "FONE", "PILHA", "CARREGADOR", "CONTROLE", "TELEVISÃO", "RÁDIO", "BATERIA", "VELA", "FÓSFORO", "ISQUEIRO", "CORDA", "CADEADO", "PARAFUSO", "PREGO", "ALICATE", "SERRA", "ÁRVORE", "FLORESTA", "MONTANHA", "OCEANO", "DESERTO", "VULCÃO", "CACHOEIRA", "PLANTA", "FLOR", "JARDIM", "TERRA", "PEDRA", "AREIA", "NUVEM", "CHUVA", "VENTO", "TROVÃO", "RELÂMPAGO", "SOL", "LUA", "ESTRELA", "COMETA", "PLANETA", "GALÁXIA", "NEBLINA", "GELO", "NEVE", "ILHA", "PRAIA", "RIO", "LAGO", "PÂNTANO", "CAVERNA", "PENHASCO", "VALE", "ONDAS", "MARÉ", "FURACÃO", "TORNADO", "ARCO-ÍRIS", "CACHORRO", "GATO", "CAVALO", "ELEFANTE", "LEÃO", "TIGRE", "GIRAFA", "ZEBRA", "MACACO", "COELHO", "RATO", "ESQUILO", "URSO", "LOBO", "RAPOSA", "COBRA", "JACARÉ", "TARTARUGA", "SAPO", "PEIXE", "TUBARÃO", "BALEIA", "GOLFINHO", "PÁSSARO", "ÁGUIA", "CORUJA", "PATO", "GALINHA", "PINGUIM", "ABELHA", "FORMIGA", "ARANHA", "BORBOLETA", "MOSQUITO", "BARATA", "ESCORPIÃO", "CARANGUEJO", "POLVO", "ESTRELA-DO-MAR", "MORCEGO", "BANANA", "MAÇÃ", "LARANJA", "UVA", "MELANCIA", "ABACAXI", "MORANGO", "LIMÃO", "PERA", "MANGA", "ARROZ", "FEIJÃO", "MACARRÃO", "CARNE", "FRANGO", "PEIXE", "OVO", "QUEIJO", "PÃO", "MANTEIGA", "PIZZA", "HAMBÚRGUER", "PASTEL", "COXINHA", "SALADA", "SOPA", "BOLO", "SORVETE", "CHOCOLATE", "DOCE", "CAFÉ", "LEITE", "SUCO", "CERVEJA", "VINHO", "ÁGUA", "REFRIGERANTE", "CHÁ", "PIPOCA", "BATATA", "AVIÃO", "CARRO", "MOTO", "NAVIO", "BARCO", "TREM", "METRÔ", "ÔNIBUS", "BICICLETA", "FOGUETE", "ESTRADA", "PONTE", "AEROPORTO", "PORTO", "ESTAÇÃO", "HOTEL", "MALA", "PASSAPORTE", "MAPA", "BÚSSOLA", "MOCHILEIRO", "DESTINO", "TURISMO", "FÉRIAS", "CRUZEIRO", "VOO", "BILHETE", "RODOVIA", "PEDÁGIO", "GASOLINA", "MIAMI", "ORLANDO", "BRASÍLIA", "PARIS", "LONDRES", "TÓQUIO", "ROMA", "EGITO", "CHINA", "BRASIL", "CATEDRAL", "CONGRESSO", "ESTÁDIO", "TEATRO", "MUSEU", "IGREJA", "PARQUE", "PRAÇA", "BIBLIOTECA", "ESCOLA", "FACULDADE", "HOSPITAL", "BANCO", "MERCADO", "SHOPPING", "RESTAURANTE", "PADARIA", "FARMÁCIA", "POSTO", "DPREV", "ESPLANADA", "LAGO", "PONTE", "QUADRA", "BLOCO", "EIXÃO", "TESOURINHA", "PLANALTO", "ALVORADA", "TORRE", "FUTEBOL", "BASQUETE", "VÔLEI", "TÊNIS", "NATAÇÃO", "CORRIDA", "BOXE", "JUDÔ", "SURFE", "SKATE", "BOLA", "CHUTEIRA", "RAQUETE", "REDE", "PISCINA", "ACADEMIA", "GOL", "CESTA", "MEDALHA", "TROFÉU", "CINEMA", "FILME", "ATOR", "MÚSICA", "SHOW", "DANÇA", "TEATRO", "LIVRO", "POESIA", "PINTURA", "MÉDICO", "ADVOGADO", "POLICIAL", "BOMBEIRO", "PROFESSOR", "COZINHEIRO", "ARTISTA", "PILOTO", "MOTORISTA", "DENTISTA", "ENGENHEIRO", "ARQUITETO", "CIENTISTA", "ASTRONAUTA", "PINTOR", "MÚSICO", "ESCRITOR", "FOTÓGRAFO", "JORNALISTA", "ATLETA", "PROGRAMADOR", "DESIGNER", "VENDEDOR", "GARÇOM", "CARPINTEIRO", "ELETRICISTA", "PEDREIRO", "MECÂNICO", "FAZENDEIRO", "VETERINÁRIO", "CABEÇA", "CORAÇÃO", "CÉREBRO", "MÃO", "PÉ", "OLHO", "NARIZ", "BOCA", "ORELHA", "BRAÇO", "PERNA", "DEDO", "DENTE", "LÍNGUA", "SANGUE", "OSSO", "PELE", "CABELO", "UNHA", "PULMÃO", "AZUL", "VERMELHO", "VERDE", "AMARELO", "ROXO", "ROSA", "LARANJA", "PRETO", "BRANCO", "CINZA", "AMOR", "PAZ", "GUERRA", "TEMPO", "SORTE", "MEDO", "ALEGRIA", "TRISTEZA", "SONHO", "CÓDIGO", "JUSTIÇA", "LEI", "CRIME", "VERDADE", "MENTIRA", "PODER", "DINHEIRO", "RIQUEZA", "POBREZA", "SORTE", "ÁTOMO", "ELÉTRON", "CÉLULA", "DNA", "VÍRUS", "BACTÉRIA", "ENERGIA", "GRAVIDADE", "QUÍMICA", "FÍSICA", "MICROSCÓPIO", "TELESCÓPIO", "LABORATÓRIO", "EXPERIÊNCIA", "EVOLUÇÃO", "ESPÉCIE", "FÓSSIL", "CLIMA", "ESPAÇO", "BURACO-NEGRO", "GRANDE", "PEQUENO", "ALTO", "BAIXO", "QUENTE", "FRIO", "RÁPIDO", "LENTO", "FORTE", "FRACO", "BONITO", "FEIO", "VELHO", "NOVO", "CARO", "BARATO", "DIFÍCIL", "FÁCIL", "PERIGOSO", "SEGURO", "RENOVADO", "ANTIGO", "MODERNO", "FUTURO", "PASSADO", "PRESENTE", "ETERNIDADE", "MISTÉRIO", "MAGIA", "FANTASMA", "MOEDA", "SINO", "ESCADA", "ÂNCORA", "BANDEIRA", "COROA", "CETRO", "ESCUDO", "ESPADA", "ARCO", "FLECHA", "BOMBA", "DINAMITE", "RADAR", "SONAR", "SATÉLITE", "DRONE", "ROBÔ", "CIBORGUE", "CHIP", "LENTE", "ÓCULOS", "RELÓGIO", "AMPULHETA", "BÚSSOLA", "TERMÔMETRO", "BALANÇA", "LUPA", "IMÃ", "MOLA", "ABACATE", "ACEROLA", "AÇO", "AGULHA", "ALFACE", "ALGODÃO", "ALHO", "AMÊNDOA", "AMETISTA", "ANEL", "ANTENA", "ANZOL", "APITO", "AQUÁRIO", "ARAME", "AREIA", "ARGILA", "ARMÁRIO", "ARPA", "ASPIRADOR", "AZEITE", "BACALHAU", "BACIA", "BAGAGEM", "BAILARINA", "BAIXO", "BALANÇO", "BALÃO", "BAMBU", "BANCO", "BANDEIRA", "BANHO", "BARALHO", "BARBA", "BARRACA", "BARRIL", "BARRO", "BASTÃO", "BATOM", "BAÚ", "BEBÊ", "BEIJO", "BELICHE", "BERMUDA", "BETERRABA", "BICO", "BIFE", "BIGODE", "BINÓCULO", "BISCOITO", "BLUSA", "BOA", "BOBINA", "BOCA", "BOI", "BOLETO", "BOLSA", "BOMBEIRO", "BONECA", "BONÉ", "BORRACHA", "BOTA", "BOTÃO", "BRACELETE", "BRANCO", "BRINCO", "BRINQUEDO", "BROCHE", "BRUXA", "BULE", "BURACO", "BUZINA", "CABANA", "CABIDE", "CABO", "CAÇADOR", "CACHIMBO", "CACHO", "CACTO", "CADARÇO", "CAIXA", "CAIXÃO", "CALÇA", "CALÇADA", "CALDO", "CALENDÁRIO", "CALHA", "CALOR", "CAMA", "CAMINHAO", "CAMISA", "CAMPAINHA", "CAMPEÃO", "CAMPINA", "CAMPO", "CANAL", "CANÁRIO", "CANCELA", "CANDEEIRO", "CANDIDATO", "CANELA", "CANHAMO", "CANHÃO", "CANO", "CANOA", "CANOPLA", "CANSAÇO", "CANTOR", "CANUDO", "CAPA", "CAPACETE", "CAPITAL", "CAPIVARA", "CAPUZ", "CARA", "CARACOL", "CARAMELO", "CARANGUEJO", "CARAVELA", "CARBONO", "CARNEIRO", "CARONA", "CARROÇA", "CARRINHO", "CARTÃO", "CARTAZ", "CARVALHO", "CARVÃO", "CASCA", "CAPACETE", "CASCO", "CASTANHA", "CAVALO", "CEBOLA", "CEDRO", "CELULAR", "CENOURA", "CENTRO", "CERA", "CEREJA", "CERVO", "CESTA", "CHÁ", "CHALEIRA", "CHAMINÉ", "CHAMPANHE", "CHAPÉU", "CHARQUE", "CHAVEIRO", "CHEFE", "CHEIRO", "CHICOTE", "CHIFRE", "CHINELO", "CHOCALHO", "CHOPP", "CHURRASCO", "CHUVAS", "CILINDRO", "CIMENTO", "CINTO", "CINZA", "CIRCO", "CISNE", "CIÚME", "CLARINETE", "CLIPES", "CLORO", "COFRE", "COGUMELO", "COLA", "COLEIRA", "COLETE", "COELHO", "COLHER", "COLMEIA", "COLUNA", "COMANDO", "COMIDA", "CÔMODA", "COMPASSO", "COMPUTADOR", "CONCHA", "CONE", "CONFIANÇA", "CONGELADOR", "CONVITE", "COPO", "CORAL", "CORDA", "CORDÃO", "CORNETA", "COROA", "CORPO", "CORREIO", "CORRENTE", "CORRIDA", "CORUJA", "COSMOS", "COSTA", "COSTELA", "COTOVELO", "COURO", "COVEIRO", "COZINHA", "CRÂNIO", "CRAVO", "CREME", "CRIANÇA", "CRISTAL", "CROCODILO", "CRUZ", "CUBO", "CUECA", "CUIA", "CÚPULA", "CURATIVO", "CURVA", "DADO", "DARDO", "DEGRAU", "DELFIN", "DENTISTA", "DEPOIMENTO", "DESENHO", "DESERTO", "DESFILE", "DESPERTADOR", "DESTINO", "DETETIVE", "DIA", "DIAMANTE", "DIÁRIO", "DICIONÁRIO", "DIETA", "DIGITAL", "DINOSSAURO", "DIREITO", "DISCO", "DISFARCE", "DIVA", "DIVÓRCIO", "DOBRADIÇA", "DOCE", "DOCUMENTO", "DOENÇA", "DOMINÓ", "DONO", "DOR", "DORMITÓRIO", "DOUTRINA", "DRAGÃO", "DRENO", "DROGA", "DUENDE", "DUQUE", "DÚVIDA", "ECLIPSE", "ECO", "EDITORA", "EDIFÍCIO", "EDUCAÇÃO", "EFEITO", "EIXO", "ELÁSTICO", "ELEFANTE", "ELEVADOR", "ELMO", "ELO", "EMBAIXADA", "EMBALAGEM", "EMBOSCADA", "EMPRESA", "ENVELOPE", "ENXADA", "ENXAME", "EQUIPE", "ESCALA", "ESCAMAS", "ESCARAVELHO", "ESCORREGADOR", "ESCORPIÃO", "ESCRITA", "ESCUDO", "ESCULTURA", "ESCURIDÃO", "ESFERA", "ESFINGE", "ESPINHA", "ESPONJA", "ESPORA", "ESPORTE", "ESQUEMA", "ESQUILO", "ESTÁDIO", "ESTÁTUA", "ESTEIRA", "ESTILINGUE", "ESTOQUE", "ESTRADA", "ESTRELA", "ESTRUTURA", "ESTUDO", "ETIQUETA", "EVAPORAÇÃO", "EXAME", "EXÉRCITO", "EXTINTOR", "FÁBRICA", "FACA", "FADA", "FAIXA", "FALCÃO", "FAMÍLIA", "FANTASIA", "FANTASMA", "FARELO", "FARINHA", "FAROL", "FARPA", "FATO", "FAZENDA", "FEBRE", "FECHADURA", "FEITIÇO", "FEIXE", "FELICIDADE", "FENDA", "FERA", "FERIADO", "FERMENTO", "FERRADURA", "FERRAMENTA", "FERRO", "FERROVIA", "FESTA", "FESTIVAL", "FIADO", "FIBRA", "FICHA", "FIGO", "FILA", "FILTRO", "FINANÇAS", "FIO", "FITA", "FIVELA", "FLAMENGO", "FLAUTA", "FLECHA", "FLOR", "FOCO", "FOGUETE", "FOLHA", "FONTE", "FORMA", "FORMIGA", "FORNO", "FORTALEZA", "FÓSSIL", "FOTO", "FRAÇÃO", "FRASCO", "FREIO", "FRENTE", "FRUTA", "FUMAÇA", "FUNDO", "FURACÃO", "FUSÍVEL", "FUTURO", "GAIOLA", "GAIVOTA", "GALAXY", "GALERIA", "GALHO", "GALINHA", "GALO", "GANCHO", "GANGORRA", "GARAGEM", "GARANHÃO", "GARFO", "GARGALO", "GARRA", "GARRAFA", "GASOLINA", "GATO", "GAVETA", "GAVIÃO", "GELO", "GEMA", "GENERAL", "GÊNIO", "GENIVA", "GEOGRAFIA", "GERADOR", "GERENTE", "GESSO", "GESTAÇÃO", "GIGANTE", "GINÁSTICA", "GIRAFA", "GIRASSOL", "GLOBO", "GLÚTEN", "GOL", "GOLF", "GOLFINHO", "GOMA", "GOTEIRA", "GOVERNO", "GRADE", "GRAFITE", "GRAMA", "GRAMPO", "GRANADA", "GRANITO", "GRÃO", "GRAVATA"];

    let peer, conn, dadosPartida = { palavras: [] }, vitoriasGerais = { azul: 0, vinho: 0 };
    let metas = { azul: 8, vinho: 8 }, progresso = { azul: 0, vinho: 0 }, currentUrl = "";
    
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function tocarSom(tipo) {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        if (tipo === 'ponto') { osc.frequency.setValueAtTime(523, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1); }
        else if (tipo === 'neutro') { osc.frequency.setValueAtTime(330, audioCtx.currentTime); }
        else if (tipo === 'preto') { osc.frequency.setValueAtTime(110, audioCtx.currentTime); osc.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.3); }
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
    }

    function tocarSomFanfarra() {
        const notas = [261.63, 329.63, 392.00, 523.25];
        notas.forEach((freq, i) => {
            setTimeout(() => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start(); osc.stop(audioCtx.currentTime + 0.4);
            }, i * 150);
        });
    }

    function criarPeer() {
        if (peer) peer.destroy();
        peer = new Peer();
        peer.on('open', (id) => {
            currentUrl = window.location.href.split('?')[0] + '?sala=' + id;
            document.getElementById('qrcode').innerHTML = '';
            new QRCode(document.getElementById("qrcode"), { text: currentUrl, width: 150, height: 150 });
            configurarNovaRodada();
        });
        peer.on('connection', (c) => {
            conn = c;
            conn.on('open', () => enviarDadosAoCapitao());
            conn.on('data', (data) => { 
                if (data.type === 'REVELAR') {
                    limparDestaquesTV();
                    animarERevelar(data.index); 
                }
                else if (data.type === 'DESTACAR') {
                    destacarPalavraTV(data.index);
                }
                else if (data.type === 'CANCELAR_DESTAQUE') {
                    limparDestaquesTV();
                }
            });
        });
    }

    function destacarPalavraTV(index) {
        limparDestaquesTV();
        const cards = document.querySelectorAll('#tabuleiro .card');
        if (cards[index]) cards[index].classList.add('foco-selecao');
    }

    function limparDestaquesTV() {
        const cards = document.querySelectorAll('#tabuleiro .card');
        cards.forEach(c => c.classList.remove('foco-selecao'));
    }

    function abrirLinkTeste() { if (currentUrl) window.open(currentUrl, '_blank'); }

    function configurarNovaRodada() {
        progresso = { azul: 0, vinho: 0 };
        const quemComeca = Math.random() > 0.5 ? 'azul' : 'vinho';
        metas.azul = (quemComeca === 'azul') ? 9 : 8;
        metas.vinho = (quemComeca === 'vinho') ? 9 : 8;
        
        const corClasse = quemComeca === 'azul' ? 'txt-azul' : 'txt-vermelho';
        const nomeTime = quemComeca === 'azul' ? 'AZUL' : 'VERMELHO';
        document.getElementById('aviso-inicio').innerHTML = `Nesta rodada, o <span class="${corClasse}">TIME ${nomeTime}</span> começa!`;
        
        atualizarPlacarInterface();
        const embaralhado = [...palavrasBanco].sort(() => 0.5 - Math.random()).slice(0, 25);
        const cores = [...Array(metas.azul).fill('azul'), ...Array(metas.vinho).fill('vinho'), ...Array(7).fill('neutro'), 'preto'].sort(() => 0.5 - Math.random());
        dadosPartida.palavras = embaralhado.map((p, i) => ({ texto: p, cor: cores[i], revelada: false }));
        renderizarTabuleiroTV();
    }

    function animarERevelar(index) {
        const p = dadosPartida.palavras[index];
        const cards = document.querySelectorAll('#tabuleiro .card');
        cards[index].classList.add('revelando');
        
        if (p.cor === 'azul' || p.cor === 'vinho') tocarSom('ponto');
        else if (p.cor === 'neutro') tocarSom('neutro');
        else tocarSom('preto');

        setTimeout(() => {
            p.revelada = true;
            if (p.cor === 'azul') progresso.azul++;
            if (p.cor === 'vinho') progresso.vinho++;
            atualizarPlacarInterface();
            renderizarTabuleiroTV();
            enviarDadosAoCapitao();
            checarFim(p.cor);
        }, 500);
    }

    function atualizarPlacarInterface() {
        document.getElementById('score-azul').innerText = `${progresso.azul}/${metas.azul}`;
        document.getElementById('score-vinho').innerText = `${progresso.vinho}/${metas.vinho}`;
    }

    function checarFim(corRevelada) {
        if (corRevelada === 'preto') abrirOverlay('assassino');
        else if (progresso.azul === metas.azul) registrarVitoria('azul', true);
        else if (progresso.vinho === metas.vinho) registrarVitoria('vinho', true);
    }

    function abrirOverlay(modo, time = '') {
        const overlay = document.getElementById('overlay');
        overlay.style.display = 'flex';
        tocarSomFanfarra();
        if (modo === 'assassino') {
            overlay.style.backgroundColor = 'rgba(20, 20, 20, 0.98)';
            document.getElementById('pergunta-vencedor').classList.remove('hidden');
            document.getElementById('aviso-vitoria').classList.add('hidden');
        } else {
            overlay.style.backgroundColor = (time === 'azul') ? 'rgba(0, 168, 255, 0.95)' : 'rgba(128, 0, 32, 0.95)';
            document.getElementById('pergunta-vencedor').classList.add('hidden');
            document.getElementById('aviso-vitoria').classList.remove('hidden');
            document.getElementById('texto-vitoria').innerText = `VITÓRIA DO TIME ${time === 'azul' ? 'AZUL' : 'VERMELHO'}!`;
        }
    }

    function registrarVitoria(vencedor, automático = false) {
        if (vencedor === 'azul') vitoriasGerais.azul++;
        if (vencedor === 'vinho') vitoriasGerais.vinho++;
        document.getElementById('v-azul').value = vitoriasGerais.azul;
        document.getElementById('v-vinho').value = vitoriasGerais.vinho;
        if (automático) abrirOverlay('auto', vencedor); else gerarNovaRodada();
        enviarDadosAoCapitao();
    }

    function sincronizarPlacarManual() {
        vitoriasGerais.azul = parseInt(document.getElementById('v-azul').value) || 0;
        vitoriasGerais.vinho = parseInt(document.getElementById('v-vinho').value) || 0;
        enviarDadosAoCapitao();
    }

    function gerarNovaRodada() {
        document.getElementById('overlay').style.display = 'none';
        criarPeer();
    }

    function renderizarTabuleiroTV() {
        const container = document.getElementById('tabuleiro'); container.innerHTML = '';
        dadosPartida.palavras.forEach((p, i) => {
            const div = document.createElement('div');
            div.className = `card ${p.revelada ? p.cor : ''}`;
            div.innerText = p.texto;
            container.appendChild(div);
        });
    }

    function enviarDadosAoCapitao() { 
        if (conn && conn.open) {
            conn.send({ type: 'SINCRONIZAR', dados: dadosPartida, vitorias: vitoriasGerais }); 
        }
    }

    // --- LÓGICA DO CAPITÃO ---
    function iniciarCapitao(salaId) {
        // Esconde a TV
        document.getElementById('tela-tv').classList.add('hidden');
        
        // ESCONDE O PLACAR PRETO DO TOPO NO CELULAR
        document.getElementById('campeonato').style.display = 'none'; 
        
        // Mostra o gabarito
        document.getElementById('tela-capitao').classList.remove('hidden');
        
        peer = new Peer();
        peer.on('open', () => {
            const connCap = peer.connect(salaId);
            connCap.on('data', (data) => { 
                if (data.type === 'SINCRONIZAR') {
                    renderizarGabarito(data.dados, connCap);
                    // Atualiza o placar colorido (que fica acima do gabarito)
                    document.getElementById('cap-v-azul').innerText = data.vitorias.azul;
                    document.getElementById('cap-v-vinho').innerText = data.vitorias.vinho;
                }
            });
        });
    }

    function renderizarGabarito(dados, conexao) {
        const container = document.getElementById('tabuleiro-capitao'); container.innerHTML = '';
        dados.palavras.forEach((p, i) => {
            const div = document.createElement('div');
            div.className = `card gabarito-card ${p.cor} ${p.revelada ? 'revelada-cap' : ''}`;
            div.innerText = p.texto;
            
            div.onclick = () => { 
                if(!p.revelada) {
                    conexao.send({ type: 'DESTACAR', index: i });
                    setTimeout(() => {
                        if(confirm(`Revelar a palavra "${p.texto}"?`)) {
                            conexao.send({ type: 'REVELAR', index: i });
                        } else {
                            conexao.send({ type: 'CANCELAR_DESTAQUE' });
                        }
                    }, 150);
                }
            };
            container.appendChild(div);
        });
    }

    const salaId = new URLSearchParams(window.location.search).get('sala');
    if (salaId) iniciarCapitao(salaId); else criarPeer();
</script>
<br>
<div>V 1.2 | 14/02/2026 | GABRIEL ANGST</div>
</body>
</html>